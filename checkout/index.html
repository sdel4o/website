<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"><title>Checkout - Veloxxa</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600&display=swap" rel="stylesheet">
<script src="shipping_settings.js"></script>
<style>
    body { font-family: 'Montserrat', 'Helvetica Neue', Helvetica, Arial, sans-serif; background: #f8f9fa; margin: 0; padding: 0; color: #333; }
    
    .header-bar { 
        background: white; 
        width: 100%; 
        padding: 20px 0; 
        text-align: center; 
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        margin-bottom: 40px;
    }
    .logo { max-width: 100px; border: none; }

    .page-wrapper { max-width: 1200px; margin: 0 auto; padding: 0 20px 40px; }

    .checkout-master { 
        display: flex; 
        gap: 30px; 
        align-items: flex-start; 
    }

    .checkout-left { 
        flex: 1.1; 
        background: white; 
        padding: 35px; 
        border-radius: 12px; 
        box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
    }

    .checkout-right { 
        flex: 1; 
        background: white; 
        padding: 30px; 
        border-radius: 12px; 
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        position: sticky;
        top: 20px;
    }

    .cart-item { display: flex; align-items: center; gap: 15px; border-bottom: 1px solid #f0f0f0; padding: 15px 0; }
    .cart-item img { width: 65px; height: 65px; object-fit: contain; border-radius: 6px; background: #fafafa; border: 1px solid #eee; }
    .item-info { flex: 1; }
    .item-title { font-weight: 600; font-size: 0.85em; margin-bottom: 2px; }
    .item-meta { font-size: 0.75em; color: #777; }
    
    .qty-controls { display: flex; align-items: center; gap: 10px; margin-top: 5px; }
    .qty-btn { background: #f0f0f0; border: 1px solid #ddd; padding: 0px 8px; cursor: pointer; border-radius: 3px; font-weight: bold; font-size: 0.8em; }
    .qty-btn:hover { background: #e5e5e5; }
    
    .form-row { display: flex; gap: 15px; margin-bottom: 15px; }
    .form-group { flex: 1; display: flex; flex-direction: column; }
    .form-group label { font-size: 0.75em; font-weight: bold; margin-bottom: 6px; color: #555; }
    input, select { padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-family: inherit; font-size: 0.9em; width: 100%; box-sizing: border-box; }
    input:focus { border-color: #000; outline: none; }

    .checkbox-line { 
        display: flex; 
        align-items: center; 
        gap: 10px; 
        margin-top: 10px; 
        font-size: 0.85em; 
        font-weight: normal; 
    }
    .checkbox-line input { width: auto; margin: 0; }

    .divider { border-top: 1px solid #eee; margin: 30px 0 15px; padding-top: 15px; font-weight: bold; font-size: 1em; text-transform: uppercase; letter-spacing: 0.5px; }
    
    .shipping-method-row {
        display: flex; align-items: center; padding: 15px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 10px; cursor: pointer; transition: all 0.2s;
    }
    .shipping-method-row:hover { border-color: #000; }
    .shipping-method-row.selected { border-color: #0058ff; background: #f0f4ff; }
    .shipping-method-row input { width: auto; margin-right: 15px; pointer-events: none; }
    .shipping-info { flex: 1; }
    .shipping-name { font-size: 0.9em; font-weight: 600; }
    .shipping-desc { font-size: 0.75em; color: #777; }
    .shipping-cost { font-weight: 600; font-size: 0.9em; }

    .payment-container { border: 1px solid #ddd; border-radius: 8px; overflow: hidden; margin-top: 15px; }
    .payment-row { 
        display: flex; align-items: center; padding: 15px; background: #fff; cursor: pointer; 
        border-bottom: 1px solid #eee; transition: background 0.2s;
    }
    .payment-row:last-child { border-bottom: none; }
    .payment-row:hover { background: #f9f9f9; }
    .payment-row input[type="radio"] { width: auto; margin-right: 15px; }
    .payment-label { flex: 1; font-weight: 600; font-size: 0.9em; }
    .payment-icons { display: flex; gap: 5px; }
    .payment-icons img { height: 18px; }

    .billing-section { 
        background: #fcfcfc; padding: 0 25px; 
        max-height: 0; overflow: hidden; 
        transition: max-height 0.3s ease-out, padding 0.3s ease;
    }
    .billing-section.active { 
        max-height: 800px; padding: 25px; border-top: 1px solid #efefef; 
    }

    .bubble-container { display: flex; gap: 10px; margin-bottom: 20px; }
    .bubble { 
        flex: 1; text-align: center; padding: 10px; border: 1px solid #ddd; 
        border-radius: 20px; font-size: 0.8em; font-weight: 600; cursor: pointer; 
        background: white; transition: all 0.2s;
    }
    .bubble.selected { background: #000; color: #fff; border-color: #000; }

    .crypto-option { 
        border: 1px solid #ddd; padding: 12px; border-radius: 6px; margin-bottom: 10px; 
        cursor: pointer; background: white; font-size: 0.9em; font-weight: 600;
        display: flex; justify-content: flex-start; align-items: center;
    }
    .crypto-option:hover { border-color: #000; }
    .crypto-address-inline { 
        font-family: monospace; font-size: 0.8em; color: #0058ff; 
        background: #f0f4ff; padding: 4px 8px; border-radius: 4px; 
        display: none; word-break: break-all; margin-left: 15px;
        font-weight: normal;
    }

    .info-trigger {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 16px;
        height: 16px;
        background: #ddd;
        border-radius: 50%;
        font-size: 10px;
        cursor: pointer;
        margin-left: 5px;
        color: #555;
        vertical-align: middle;
    }
    .info-trigger:hover { background: #ccc; }
    
    .summary-row { display: flex; justify-content: space-between; margin: 12px 0; font-size: 0.95em; }
    .total-box { border-top: 2px solid #000; margin-top: 20px; padding-top: 15px; font-weight: bold; font-size: 1.25em; display: flex; justify-content: space-between; }

    .complete-btn { 
        width: 100%; 
        background: #0058ff; 
        color: white; 
        padding: 18px; 
        border: none; 
        border-radius: 8px; 
        font-weight: bold; 
        font-size: 1em; 
        cursor: pointer; 
        margin-top: 25px; 
        transition: background 0.2s; 
    }
    .complete-btn:hover { background: #0047cc; }

    @media (max-width: 950px) {
        .checkout-master { flex-direction: column; }
        .checkout-right { order: -1; margin-bottom: 20px; position: static; width: 100%; box-sizing: border-box; }
        .checkout-left { width: 100%; box-sizing: border-box; }
        .crypto-option { flex-direction: column; align-items: flex-start; gap: 5px; }
        .crypto-address-inline { margin-left: 0; width: 100%; box-sizing: border-box; }
    }
</style>
</head>
<body>

<div class="header-bar">
    <a href="Combined_Interactive_Catalog.html">
        <img src="file://C:/Users/sdelan/Desktop/logo.png" class="logo" alt="Veloxxa Logo">
    </a>
</div>

<div class="page-wrapper">
    <div class="checkout-master">
        <div class="checkout-left">
            <h2 style="margin-top: 0; font-size: 1.4em;">Customer Information</h2>
            <div class="form-row">
                <div class="form-group"><label>First Name *</label><input type="text" id="fname" required placeholder="First name"></div>
                <div class="form-group"><label>Last Name *</label><input type="text" id="lname" required placeholder="Last name"></div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" id="email" required placeholder="jane@example.com">
                    <div class="checkbox-line">
                        <input type="checkbox" id="news" checked>
                        <label for="news">Email me news and offers</label>
                    </div>
                </div>
                <div class="form-group"><label>Phone Number *</label><input type="tel" id="phone" required placeholder="+XX XXX XXX XXXX"></div>
            </div>

            <div class="divider">Shipping Address</div>
            <div class="form-group"><label>Street Address *</label><input type="text" id="addr" required placeholder="House number and street name"></div>
            
            <div class="form-row" style="margin-top:15px;">
                <div class="form-group">
                    <label>Country *</label>
                    <select id="country" onchange="toggleCOD()"></select>
                </div>
                <div class="form-group"><label>City *</label><input type="text" id="city" required></div>
                <div class="form-group"><label>Zipcode *</label><input type="text" id="zip" required></div>
            </div>

            <div class="divider">Shipping Method</div>
            <div id="shipping_methods_container"></div>

            <div class="divider">Payment</div>
            <div class="payment-container">
                <div class="payment-row" onclick="setPaymentMethod('card')">
                    <input type="radio" name="pay_choice" id="radio_card" checked>
                    <div class="payment-label">Credit/Debit Card</div>
                    <div class="payment-icons">
                        <img src="https://img.icons8.com/color/48/000000/visa.png">
                        <img src="https://img.icons8.com/color/48/000000/mastercard.png">
                        <img src="https://img.icons8.com/color/48/000000/amex.png">
                        <img src="https://img.icons8.com/color/48/000000/discover.png">
                        <img src="https://img.icons8.com/color/48/000000/jcb.png">
                    </div>
                </div>

                <div id="card_section" class="billing-section active">
                    <div class="form-group"><label>Name on Card</label><input type="text" id="cardName" placeholder="Full name on card"></div>
                    <div class="form-group" style="margin-top: 12px;"><label>Card Number</label><input type="text" placeholder="Card number"></div>
                    <div class="form-row" style="margin-top: 12px;">
                        <div class="form-group"><label>Expiration Date</label><input type="text" placeholder="MM/YY"></div>
                        <div class="form-group"><label>CVC</label><input type="text" placeholder="XXX"></div>
                    </div>
                </div>

                <div class="payment-row" id="cod_row" style="display:none;" onclick="setPaymentMethod('cod')">
                    <input type="radio" name="pay_choice" id="radio_cod">
                    <div class="payment-label">Cash on Delivery (COD)</div>
                </div>

                <div id="cod_card_section" class="billing-section">
                    <p style="font-size: 0.8em; color: #666; margin-bottom: 15px;">A 33% Service Fee is required for COD orders. Please choose a deposit method below.</p>
                    
                    <div class="bubble-container">
                        <div class="bubble" id="bubble_card" onclick="setCODSubMethod('card')">Pay via Card</div>
                        <div class="bubble" id="bubble_crypto" onclick="setCODSubMethod('crypto')">Pay via Crypto</div>
                    </div>

                    <div id="cod_sub_card" style="display:none;">
                        <div class="form-group"><label>Name on Card</label><input type="text" id="cardNameCOD" placeholder="Full name on card"></div>
                        <div class="form-group" style="margin-top: 12px;"><label>Card Number</label><input type="text" placeholder="Card number"></div>
                        <div class="form-row" style="margin-top: 12px;">
                            <div class="form-group"><label>Expiration Date</label><input type="text" placeholder="MM/YY"></div>
                            <div class="form-group"><label>CVC</label><input type="text" placeholder="XXX"></div>
                        </div>
                    </div>

                    <div id="cod_sub_crypto" style="display:none;">
                         <p style="font-size: 0.8em; color: #cc0000; margin-bottom: 10px;">Deposit must be sent within 24 hours.</p>
                         <div class="crypto-option" onclick="showCryptoAddr('usdt_cod')">USDT <span id="addr_usdt_cod" class="crypto-address-inline">adress tbd</span></div>
                         <div class="crypto-option" onclick="showCryptoAddr('usdc_cod')">USDC <span id="addr_usdc_cod" class="crypto-address-inline">adress tbd</span></div>
                         <div class="crypto-option" onclick="showCryptoAddr('btc_cod')">Bitcoin <span id="addr_btc_cod" class="crypto-address-inline">adress tbd</span></div>
                         <div class="crypto-option" onclick="showCryptoAddr('eth_cod')">Etherium <span id="addr_eth_cod" class="crypto-address-inline">adress tbd</span></div>
                    </div>
                </div>

                <div class="payment-row" onclick="setPaymentMethod('crypto')">
                    <input type="radio" name="pay_choice" id="radio_crypto">
                    <div class="payment-label">Crypto</div>
                </div>

                <div id="crypto_section" class="billing-section">
                    <p style="font-size: 0.85em; color: #cc0000; margin-bottom: 15px; font-weight: 600;">Payment in Crypto must be sent within 24 hours or the order will be canceled.</p>
                    <div class="crypto-option" onclick="showCryptoAddr('usdt')">USDT <span id="addr_usdt" class="crypto-address-inline">adress tbd</span></div>
                    <div class="crypto-option" onclick="showCryptoAddr('usdc')">USDC <span id="addr_usdc" class="crypto-address-inline">adress tbd</span></div>
                    <div class="crypto-option" onclick="showCryptoAddr('btc')">Bitcoin <span id="addr_btc" class="crypto-address-inline">adress tbd</span></div>
                    <div class="crypto-option" onclick="showCryptoAddr('eth')">Etherium <span id="addr_eth" class="crypto-address-inline">adress tbd</span></div>
                </div>
            </div>

            <button class="complete-btn" onclick="processOrder()">Complete Purchase</button>
            <p style="text-align: center; font-size: 0.75em; color: #999; margin-top: 20px;">Shipping & Billing Address must match exactly for security purposes.</p>
        </div>

        <div class="checkout-right">
            <h3 style="margin-top: 0; font-size: 1.1em; border-bottom: 1px solid #eee; padding-bottom: 10px;">Order Summary</h3>
            <div id="cartList"></div>
            <div style="margin-top: 25px;">
                <div class="summary-row" style="font-weight: bold; font-size: 1.0em; border-bottom: 2px solid #000; padding-bottom: 15px; margin-bottom: 15px;"><span>Subtotal</span><span id="subtotalBox">$0.00</span></div>
                <div class="summary-row">
                    <span>
                        Service Fee (33%) 
                        <span class="info-trigger" onclick="showServiceInfo()">?</span>
                    </span>
                    <span id="serviceFeeBox" style="color: #666;">Included</span>
                </div>
                <div class="summary-row"><span>Shipping</span><span id="shippingBox">$0.00</span></div>
                <div class="total-box"><span>Total</span><span id="totalBox">$0.00</span></div>
            </div>
            <a href="Combined_Interactive_Catalog.html" style="display: block; text-align: center; margin-top: 25px; color: #888; text-decoration: none; font-size: 0.85em;">← Return to Catalog</a>
        </div>
    </div>
</div>

<script>
const STORAGE_KEY = "catalog_cart";
const CONFIG = typeof VELOXXA_CONFIG !== 'undefined' ? VELOXXA_CONFIG : {};
const FEE_PERCENT = 0; 

let cart = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
let selectedShippingId = null; 
let codSubMethod = null;

function showServiceInfo() {
    alert("This fee covers processing and handling. For COD orders, it must be paid in advance. For more information please visit https://veloxxa.com/pages/shipping-payment");
}

function initCountries() {
    const select = document.getElementById("country");
    if (!CONFIG.AVAILABLE_COUNTRIES) return;
    CONFIG.AVAILABLE_COUNTRIES.forEach(c => {
        let opt = document.createElement("option");
        opt.value = c; opt.textContent = c;
        select.appendChild(opt);
    });
}

function toggleCOD() {
    const selectedCountry = document.getElementById("country").value;
    const codRow = document.getElementById("cod_row");
    if (CONFIG.COD_COUNTRIES && CONFIG.COD_COUNTRIES.includes(selectedCountry)) {
        codRow.style.display = "flex";
    } else {
        codRow.style.display = "none";
        if(document.getElementById("radio_cod").checked) setPaymentMethod('card');
    }
}

function setPaymentMethod(method) {
    const sections = ['card_section', 'cod_card_section', 'crypto_section'];
    sections.forEach(s => document.getElementById(s).classList.remove("active"));
    
    if (method === 'card') {
        document.getElementById("radio_card").checked = true;
        document.getElementById("card_section").classList.add("active");
    } else if (method === 'cod') {
        document.getElementById("radio_cod").checked = true;
        document.getElementById("cod_card_section").classList.add("active");
    } else if (method === 'crypto') {
        document.getElementById("radio_crypto").checked = true;
        document.getElementById("crypto_section").classList.add("active");
    }
}

function setCODSubMethod(sub) {
    codSubMethod = sub;
    document.getElementById("cod_sub_card").style.display = (sub === 'card') ? "block" : "none";
    document.getElementById("cod_sub_crypto").style.display = (sub === 'crypto') ? "block" : "none";
    document.getElementById("bubble_card").classList.toggle("selected", sub === 'card');
    document.getElementById("bubble_crypto").classList.toggle("selected", sub === 'crypto');
}

function selectShipping(id) {
    selectedShippingId = id;
    render();
}

function showCryptoAddr(coinID) {
    const allAddr = document.querySelectorAll(".crypto-address-inline");
    allAddr.forEach(a => a.style.display = "none");
    const target = document.getElementById("addr_" + coinID);
    if(target) target.style.display = "inline-block";
}

function render() {
    const list = document.getElementById("cartList");
    let subtotal = 0;
    let totalWeight = 0;
    list.innerHTML = "";
    
    if(cart.length === 0) { 
        list.innerHTML = "<p style='text-align:center; padding: 20px; color: #999;'>Your cart is empty.</p>"; 
    }

    cart.forEach((item, idx) => {
        const price = parseFloat(item.price) || 0;
        const qty = parseInt(item.qty) || 1;
        const weight = parseFloat(item.weight) || 1.0; 
        const lineTotal = price * qty;
        subtotal += lineTotal;
        totalWeight += (weight * qty);

        list.innerHTML += `<div class="cart-item">
            <img src="${item.img || ''}">
            <div class="item-info">
                <div class="item-title">${item.name}</div>
                <div class="item-meta">Size: ${item.size || 'N/A'} | $${price.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
                <div class="qty-controls">
                    <button class="qty-btn" onclick="updateQty(${idx}, -1)">-</button>
                    <span style="font-size: 0.8em; font-weight: 600;">${qty}</span>
                    <button class="qty-btn" onclick="updateQty(${idx}, 1)">+</button>
                </div>
            </div>
            <div style="text-align: right;">
                <button onclick="removeItem(${idx})" style="color:#cc0000; border:none; background:none; cursor:pointer; font-size: 0.75em;">Remove ✕</button>
                <div style="font-weight:bold; font-size:0.9em; margin-top:5px;">$${lineTotal.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
            </div>
        </div>`;
    });

// Weight-Based Logic for Shipping
    let activePrice = 0;
    const shipContainer = document.getElementById("shipping_methods_container");
    shipContainer.innerHTML = "";

    if (CONFIG.SHIPPING_METHODS) {
        CONFIG.SHIPPING_METHODS.forEach(m => {
            let cost = m.price;
            let isDisabled = false;
            let standardNote = ""; // Variable to hold the specific note
            
            // 1. Calculate Express Tiers
            if (m.id === 'express' && CONFIG.EXPRESS_TIERS) {
                const tier = CONFIG.EXPRESS_TIERS.find(t => totalWeight <= t.max_w);
                cost = tier ? tier.price : CONFIG.EXPRESS_TIERS[CONFIG.EXPRESS_TIERS.length-1].price;
            }

            // 2. Standard Shipping Rules & Note
            if (m.id === 'standard') {
                const priceMet = subtotal >= CONFIG.FREE_SHIPPING_THRESHOLD;
                const weightMet = totalWeight <= CONFIG.FREE_MAX_WEIGHT;
                
                // Add the weight disclaimer ONLY for standard shipping
                standardNote = `<div style="font-size: 0.7em; color: #888; margin-top: 5px; font-style: italic;">
                    Note: Each pair of shoes is considered ~4lbs for calculation.
                </div>`;
                
                if (priceMet && weightMet) {
                    cost = 0;
                } else {
                    isDisabled = true;
                    cost = 0;
                    // Add the "Why it's locked" message
                    standardNote += `<div style="color: #cc0000; font-size: 0.8em; margin-top: 5px; font-weight: 600;">
                        Locked: Requires $${CONFIG.FREE_SHIPPING_THRESHOLD.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}+ and under ${CONFIG.FREE_MAX_WEIGHT}lbs. (Current: $${subtotal.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})} / ${totalWeight.toFixed(1)}lbs)
                    </div>`;
                }
            }

            // 3. Selection & Fallback Logic
            if(selectedShippingId === m.id) {
                if (isDisabled) {
                    selectedShippingId = null; // Don't auto-select if disabled
                    activePrice = 0;
                } else {
                    activePrice = cost;
                }
            }

            // 4. Render the Row
            shipContainer.innerHTML += `
                <div class="shipping-method-row ${selectedShippingId === m.id ? 'selected' : ''} ${isDisabled ? 'disabled-method' : ''}" 
                     ${isDisabled ? '' : `onclick="selectShipping('${m.id}')"`}
                     style="${isDisabled ? 'opacity: 0.6; cursor: not-allowed; background: #f9f9f9;' : ''}">
                    <input type="radio" name="ship_radio" ${selectedShippingId === m.id ? 'checked' : ''} ${isDisabled ? 'disabled' : ''}>
                    <div class="shipping-info">
                        <div class="shipping-name">${m.name} ${isDisabled ? '(Locked)' : ''}</div>
                        <div class="shipping-desc">${m.desc}${standardNote}</div>
                    </div>
                    <div class="shipping-cost">${cost === 0 ? 'FREE' : '$' + cost.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
                </div>`;
        });
    }

    const serviceFee = subtotal * FEE_PERCENT;
    const currentTotal = subtotal + activePrice + serviceFee;
    
    document.getElementById("subtotalBox").textContent = "$" + subtotal.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
    
    const feeDisplay = document.getElementById("serviceFeeBox");
    if (FEE_PERCENT === 0) {
        feeDisplay.textContent = "Included";
    } else {
        feeDisplay.textContent = "$" + serviceFee.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
    }
    
    const sBox = document.getElementById("shippingBox");
    sBox.textContent = activePrice === 0 ? "FREE" : "$" + activePrice.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
    sBox.style.color = activePrice === 0 ? "#666" : "#333";
    
    document.getElementById("totalBox").textContent = "$" + currentTotal.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
    toggleCOD();
}

function updateQty(idx, change) {
    let currentQty = parseInt(cart[idx].qty) || 1;
    if (change === -1 && currentQty <= 1) return; 
    cart[idx].qty = currentQty + change;
    saveAndRender();
}

function removeItem(idx) { cart.splice(idx, 1); saveAndRender(); }
function saveAndRender() { localStorage.setItem(STORAGE_KEY, JSON.stringify(cart)); render(); }

function processOrder() {

 // Add this check at the very top of the function
    if (!selectedShippingId) {
        alert("Please select a shipping method to continue.");
        return;
    }
    
    const isCOD = document.getElementById("radio_cod").checked;
    const isCry = document.getElementById("radio_crypto").checked;
    const f = document.getElementById("fname").value.trim();
    const l = document.getElementById("lname").value.trim();
    
    if(cart.length === 0) { alert("Your cart is empty."); return; }
    if(!f || !l) { alert("Please fill in your name."); return; }

    if (isCOD && !codSubMethod) {
        alert("Please select a deposit method (Card or Crypto) for your COD order.");
        return;
    }

    let needsCardCheck = (document.getElementById("radio_card").checked || (isCOD && codSubMethod === 'card'));
    
    if (needsCardCheck) {
        const inputID = (isCOD) ? "cardNameCOD" : "cardName";
        const cn = document.getElementById(inputID).value.trim();
        if(cn.toLowerCase() !== (f + " " + l).toLowerCase()) {
            alert("Error: Cardholder name must match the Billing Name exactly.");
            return;
        }
    }

    if(isCOD) {
        alert("Thank you! Order request submitted via COD. Please ensure the deposit is finalized.");
    } else if (isCry) {
        alert("Order placed! Please send crypto payment within 24 hours.");
    } else {
        alert("Thank you! Order request submitted via Credit Card.");
    }

    // Create the Order Object - Creating the invoice for the customer
        const orderData = {
        name: document.getElementById("fname").value + " " + document.getElementById("lname").value,
        email: document.getElementById("email").value,
        phone: document.getElementById("phone").value,
        addr: document.getElementById("addr").value,
        city: document.getElementById("city").value,
        zip: document.getElementById("zip").value,
        country: document.getElementById("country").value,
        items: cart,
        subtotal: document.getElementById("subtotalBox").textContent,
        shipping: document.getElementById("shippingBox").textContent,
        fee: document.getElementById("serviceFeeBox").textContent,
        total: document.getElementById("totalBox").textContent,
        paymentMethod: document.querySelector('input[name="pay_choice"]:checked').parentElement.innerText.trim()
    };

    // SAVE to Session Storage (This is the key fix)
    sessionStorage.setItem('currentOrder', JSON.stringify(orderData));

    // Open the invoice template
    window.open('invoice_template.html', '_blank');
}


window.onload = () => {
    initCountries();
    render();
};
</script>
</body></html>
